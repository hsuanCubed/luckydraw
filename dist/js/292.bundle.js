"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[292],{1292:(e,t,i)=>{i.r(t),i.d(t,{default:()=>c});var a=function(){var e=this,t=e._self._c;return t("div",{ref:"box",staticClass:"modal",attrs:{id:"GetLuckyBox",tabindex:"-1",role:"dialog","data-backdrop":"static","data-keyboard":"false"}},[t("div",{staticClass:"modal-dialog",attrs:{role:"document"}},[t("div",{staticClass:"modal-content"},[e._m(0),e._v(" "),t("div",{staticClass:"modal-body"},[e.needSetWebTitle?t("div",{staticClass:"alert alert-primary",staticStyle:{flex:"0 0 auto"},attrs:{role:"alert"}},[e._v("\n                    請先設定屬於您的抽獎活動名稱\n                    "),t("button",{staticClass:"btn btn-success btn-sm",on:{click:e.gotoSetWebTitle}},[e._v("立刻去")])]):e._e(),e._v(" "),t("div",{staticClass:"get-lucky-list",class:{disabled:e.needSetWebTitle}},[e.prizeListByAward.length>0?e._l(e.prizeListByAward,(function(i){return t("button",{key:i.prize_sn,staticClass:"btn btn-success btn-lg btn-block mb-3 prizeInfo",attrs:{type:"button",disabled:i.amount<=i.count},on:{click:function(t){return e.getLucky(i)}}},[t("div",{staticClass:"row"},[t("div",{staticClass:"col-9"},[e._v("\n                                    "+e._s(i.title)+" (每次"+e._s(i.drawCount||1)+"人)\n                                ")]),e._v(" "),t("div",{staticClass:"col-3"},[e._v("\n                                    ["+e._s(i.count)+" / "+e._s(i.amount)+"]\n                                ")])])])})):[t("h4",{staticClass:"text-center p-3"},[e._v("\n                            您尚未建立獎項，無法進行抽獎\n                        ")]),e._v(" "),t("button",{staticClass:"btn btn-warning btn-block btn-lg",on:{click:e.editPrizeList}},[e._v("\n                            建立獎項\n                        ")])]],2)])])])])};a._withStripped=!0;var n=i(1582),r=i(1551),s=i(4651);const o={ding:new Audio("./dist/mp3/ding.mp3"),winner:[new Audio("./dist/mp3/winner2.mp3")]},l={components:{},filters:{},props:{},data:()=>({ValidateCandidateSN:null,ValidSNRandomRange:0,defaultRunTime:50,runTime:0,orgRunTime:0}),computed:{...(0,n.L8)(["config","triggerOpenGetLucky","prizeListByAward","candidateList","haveAwardCandidateSN","getLuckyWaitTimeArr"]),needSetWebTitle(){const e=this;let t=!1;return e.config.isTutorial||e.config.webTitle&&!["Lucky Draw","LuckyDraw","luckydraw"].includes(e.config.webTitle)||(t=!0),t}},watch:{triggerOpenGetLucky:{immediate:!0,handler(){const e=this;e.triggerOpenGetLucky?s(e.$refs.box).modal("show"):s(e.$refs.box).modal("hide")}}},created(){},mounted(){const e=this;s(e.$refs.box).bind("shown.bs.modal",(()=>{e.award="",r.Xe.mixpanel("GetLuckyOpen_click"),r.Xe.gtag("event","GetLuckyOpen_click")})),s(e.$refs.box).bind("hidden.bs.modal",(()=>{r.Xe.mixpanel("GetLuckyClose_click"),r.Xe.gtag("event","GetLuckyClose_click")})),e.triggerOpenGetLucky?s(e.$refs.box).modal("show"):s(e.$refs.box).modal("hide")},updated(){},destroyed(){},methods:{...(0,n.PY)({setFavicon:"setFavicon",setFocusCandidateSN:"setFocusCandidateSN",setFocusPrizeSN:"setFocusPrizeSN",triggerModal:"triggerModal"}),gotoSetWebTitle(){const e=this;e.triggerModal({key:"GetLucky",close:!0});const t={offset:{top:60,bottom:60},startCallback(){r.Xe.mixpanel("TutorialStart_trigger",{type:"WebsiteTitle"}),r.Xe.gtag("event","TutorialStart_trigger",{type:"WebsiteTitle"})},closeCallback(){r.Xe.mixpanel("TutorialEnd_trigger",{type:"WebsiteTitle"}),r.Xe.gtag("event","TutorialEnd_trigger",{type:"WebsiteTitle"})},step_callback(e,t){r.Xe.mixpanel("TutorialStep_trigger",{type:"WebsiteTitle",index:t.index}),r.Xe.gtag("event","TutorialStep_trigger",{type:"WebsiteTitle",index:t.index})}},i=[{target:'#SettingBox input[name="webTitle"]',title:"獨特的抽獎",intro:"在抽獎前，設定一個屬於您的獨特抽獎活動名稱。",beforeAction(t,i,a){e.triggerModal({key:"Setting"}),setTimeout((()=>{a()}),500)}}];new r.FL(i,t).run()},editPrizeList(){s(this.$refs.box).modal("hide"),this.triggerModal({key:"PrizeList"})},getLucky(e){const t=this;r.Xe.mixpanel("GetLuckyChoosePrize_click",e),r.Xe.gtag("event","GetLuckyChoosePrize_click",e);const i=e.drawCount||1,a=e.amount-e.count;if(a>=i){const{haveAwardCandidateSN:a}=t,n=[];t.candidateList.forEach((e=>{!1!==e.del||a.includes(e.sn)||n.push(e.sn)})),n.length>=i?(t.ValidateCandidateSN=n,t.ValidSNRandomRange=Math.pow(10,`${t.ValidateCandidateSN.length}`.length),s(t.$refs.box).modal("hide"),t.runTime=t.config.defaultRunTime,t.orgRunTime=t.config.defaultRunTime,r.Xe.mixpanel("GetLuckyChoosePrizeRun_trigger",e),r.Xe.gtag("event","GetLuckyChoosePrizeRun_trigger",e),t.setFocusCandidateSN(null),t.setFocusPrizeSN(e.prize_sn),t.luckyAction()):(r.Xe.mixpanel("GetLuckyChoosePrizeError_trigger",{error:"not enough candidates"}),r.Xe.gtag("event","GetLuckyChoosePrizeError_trigger",{error:"not enough candidates"}),r.lY.warning({html:`候選人不足，此獎項需要 ${i} 人，目前只有 ${n.length} 人可抽`}))}else r.Xe.mixpanel("GetLuckyChoosePrizeError_trigger",{error:"not enough"}),r.Xe.gtag("event","GetLuckyChoosePrizeError_trigger",{error:"not enough"}),r.lY.warning({html:`此獎項剩餘數量不足，需要 ${i} 個名額，但只剩 ${a} 個`})},luckyAction(){const e=this,t=parseInt(1e5*Math.random()%e.ValidateCandidateSN.length);e.setFocusCandidateSN(e.ValidateCandidateSN[t]),o.ding.play(),e.setFavicon("run");const{getLuckyWaitTimeArr:i}=e;if(e.runTime>0&&e.ValidateCandidateSN.length>1){let t=0;if(e.orgRunTime<10)t=100;else for(const a in i)if(e.runTime>=i[a].limit){t=i[a].wait;break}console.log("waitTime",t),e.runTime-=1,clearTimeout(e.luckyActionTimer),e.luckyActionTimer=setTimeout((()=>{o.ding.pause(),o.ding.currentTime=0,e.luckyAction()}),t)}else setTimeout((()=>{r.Xe.mixpanel("GetLuckyChoosePrizeStop_trigger"),r.Xe.gtag("event","GetLuckyChoosePrizeStop_trigger"),e.triggerModal({key:"Lucky"}),parseInt(10*Math.random()%o.winner.length)}),600)}}},c=(0,i(2881).A)(l,a,[function(){var e=this,t=e._self._c;return t("div",{staticClass:"modal-header"},[t("h5",{staticClass:"modal-title"},[t("i",{staticClass:"fas fa-vote-yea"}),e._v("\n                    選取獎項\n                ")]),e._v(" "),t("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal","aria-label":"Close"}},[t("span",{attrs:{"aria-hidden":"true"}},[e._v("×")])])])}],!1,null,"669806ac",null).exports}}]);
//# sourceMappingURL=292.bundle.js.map?v=e7692b3b7de6eb374a73