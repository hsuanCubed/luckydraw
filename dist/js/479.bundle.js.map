{"version":3,"file":"479.bundle.js?v=efabc9d389f0cc450e77","mappings":"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","sources":["webpack:///./components/GetLuckyBox/main.vue","webpack:///components/GetLuckyBox/main.vue","webpack:///./components/GetLuckyBox/main.vue?bfc7","webpack:///./components/GetLuckyBox/main.vue?dcfa"],"sourcesContent":["var render = function render() {\n  var _vm = this,\n    _c = _vm._self._c\n  return _c(\n    \"div\",\n    {\n      ref: \"box\",\n      staticClass: \"modal\",\n      attrs: {\n        id: \"GetLuckyBox\",\n        tabindex: \"-1\",\n        role: \"dialog\",\n        \"data-backdrop\": \"static\",\n        \"data-keyboard\": \"false\",\n      },\n    },\n    [\n      _c(\"div\", { staticClass: \"modal-dialog\", attrs: { role: \"document\" } }, [\n        _c(\"div\", { staticClass: \"modal-content\" }, [\n          _vm._m(0),\n          _vm._v(\" \"),\n          _c(\"div\", { staticClass: \"modal-body\" }, [\n            _vm.needSetWebTitle\n              ? _c(\n                  \"div\",\n                  {\n                    staticClass: \"alert alert-primary\",\n                    staticStyle: { flex: \"0 0 auto\" },\n                    attrs: { role: \"alert\" },\n                  },\n                  [\n                    _vm._v(\n                      \"\\n                    請先設定屬於您的抽獎活動名稱\\n                    \"\n                    ),\n                    _c(\n                      \"button\",\n                      {\n                        staticClass: \"btn btn-success btn-sm\",\n                        on: { click: _vm.gotoSetWebTitle },\n                      },\n                      [_vm._v(\"立刻去\")]\n                    ),\n                  ]\n                )\n              : _vm._e(),\n            _vm._v(\" \"),\n            _c(\n              \"div\",\n              {\n                staticClass: \"get-lucky-list\",\n                class: { disabled: _vm.needSetWebTitle },\n              },\n              [\n                _vm.prizeListByAward.length > 0\n                  ? _vm._l(_vm.prizeListByAward, function (prizeInfo) {\n                      return _c(\n                        \"button\",\n                        {\n                          key: prizeInfo.prize_sn,\n                          staticClass:\n                            \"btn btn-success btn-lg btn-block mb-3 prizeInfo\",\n                          attrs: {\n                            type: \"button\",\n                            disabled: prizeInfo.amount <= prizeInfo.count,\n                          },\n                          on: {\n                            click: function ($event) {\n                              return _vm.getLucky(prizeInfo)\n                            },\n                          },\n                        },\n                        [\n                          _c(\"div\", { staticClass: \"row\" }, [\n                            _c(\"div\", { staticClass: \"col-9\" }, [\n                              _vm._v(\n                                \"\\n                                    \" +\n                                  _vm._s(prizeInfo.title) +\n                                  \" (每次\" +\n                                  _vm._s(prizeInfo.drawCount || 1) +\n                                  \"人)\\n                                \"\n                              ),\n                            ]),\n                            _vm._v(\" \"),\n                            _c(\"div\", { staticClass: \"col-3\" }, [\n                              _vm._v(\n                                \"\\n                                    [\" +\n                                  _vm._s(prizeInfo.count) +\n                                  \" / \" +\n                                  _vm._s(prizeInfo.amount) +\n                                  \"]\\n                                \"\n                              ),\n                            ]),\n                          ]),\n                        ]\n                      )\n                    })\n                  : [\n                      _c(\"h4\", { staticClass: \"text-center p-3\" }, [\n                        _vm._v(\n                          \"\\n                            您尚未建立獎項，無法進行抽獎\\n                        \"\n                        ),\n                      ]),\n                      _vm._v(\" \"),\n                      _c(\n                        \"button\",\n                        {\n                          staticClass: \"btn btn-warning btn-block btn-lg\",\n                          on: { click: _vm.editPrizeList },\n                        },\n                        [\n                          _vm._v(\n                            \"\\n                            建立獎項\\n                        \"\n                          ),\n                        ]\n                      ),\n                    ],\n              ],\n              2\n            ),\n          ]),\n        ]),\n      ]),\n    ]\n  )\n}\nvar staticRenderFns = [\n  function () {\n    var _vm = this,\n      _c = _vm._self._c\n    return _c(\"div\", { staticClass: \"modal-header\" }, [\n      _c(\"h5\", { staticClass: \"modal-title\" }, [\n        _c(\"i\", { staticClass: \"fas fa-vote-yea\" }),\n        _vm._v(\"\\n                    選取獎項\\n                \"),\n      ]),\n      _vm._v(\" \"),\n      _c(\n        \"button\",\n        {\n          staticClass: \"close\",\n          attrs: {\n            type: \"button\",\n            \"data-dismiss\": \"modal\",\n            \"aria-label\": \"Close\",\n          },\n        },\n        [_c(\"span\", { attrs: { \"aria-hidden\": \"true\" } }, [_vm._v(\"×\")])]\n      ),\n    ])\n  },\n]\nrender._withStripped = true\n\nexport { render, staticRenderFns }","<template>\r\n    <div id=\"GetLuckyBox\" ref=\"box\" class=\"modal\" tabindex=\"-1\" role=\"dialog\" data-backdrop=\"static\"\r\n        data-keyboard=\"false\">\r\n        <div class=\"modal-dialog\" role=\"document\">\r\n            <div class=\"modal-content\">\r\n                <div class=\"modal-header\">\r\n                    <h5 class=\"modal-title\">\r\n                        <i class=\"fas fa-vote-yea\"></i>\r\n                        選取獎項\r\n                    </h5>\r\n                    <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\r\n                        <span aria-hidden=\"true\">&times;</span>\r\n                    </button>\r\n                </div>\r\n                <div class=\"modal-body\">\r\n                    <div v-if=\"needSetWebTitle\" role=\"alert\" class=\"alert alert-primary\" style=\"flex: 0 0 auto;\">\r\n                        請先設定屬於您的抽獎活動名稱\r\n                        <button class=\"btn btn-success btn-sm\" @click=\"gotoSetWebTitle\">立刻去</button>\r\n                    </div>\r\n                    <div class=\"get-lucky-list\" :class=\"{ disabled: needSetWebTitle }\">\r\n                        <template v-if=\"prizeListByAward.length > 0\">\r\n                            <button v-for=\"prizeInfo in prizeListByAward\" :key=\"prizeInfo.prize_sn\" type=\"button\"\r\n                                class=\"btn btn-success btn-lg btn-block mb-3 prizeInfo\"\r\n                                :disabled=\"prizeInfo.amount <= prizeInfo.count\" @click=\"getLucky(prizeInfo)\">\r\n                                <div class=\"row\">\r\n                                    <div class=\"col-9\">\r\n                                        {{ prizeInfo.title }} (每次{{ prizeInfo.drawCount || 1 }}人)\r\n                                    </div>\r\n                                    <div class=\"col-3\">\r\n                                        [{{ prizeInfo.count }} / {{ prizeInfo.amount }}]\r\n                                    </div>\r\n                                </div>\r\n                            </button>\r\n                        </template>\r\n                        <template v-else>\r\n                            <h4 class=\"text-center p-3\">\r\n                                您尚未建立獎項，無法進行抽獎\r\n                            </h4>\r\n                            <button class=\"btn btn-warning btn-block btn-lg\" @click=\"editPrizeList\">\r\n                                建立獎項\r\n                            </button>\r\n                        </template>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</template>\r\n<script>\r\nimport { mapActions, mapMutations, mapGetters } from 'vuex';\r\nimport { Tutorial, popup, trackJS } from 'lib/common/util';\r\n\r\nconst audio = {\r\n    ding: new Audio('./dist/mp3/ding.mp3'),\r\n    winner: [\r\n        // new Audio(\"./dist/mp3/winner1.mp3\"),\r\n        new Audio('./dist/mp3/winner2.mp3'),\r\n    ],\r\n};\r\n\r\n// import $ from 'jquery';\r\n// import 'bootstrap';\r\n\r\n// import 'app';\r\n// import { string, jsVars, popup, trackJS, localStorage, ppPanel } from 'lib/common/util';\r\n\r\nexport default {\r\n    components: {},\r\n    filters: {},\r\n    props: {},\r\n    data() {\r\n        return {\r\n            ValidateCandidateSN: null,\r\n            ValidSNRandomRange: 0,\r\n\r\n            defaultRunTime: 50,\r\n            runTime: 0,\r\n            orgRunTime: 0,\r\n\r\n            // 用於儲存多個中獎者的 SN\r\n            winnerCandidateSNList: [],\r\n        };\r\n    },\r\n    computed: {\r\n        ...mapGetters([\r\n            'config',\r\n            'triggerOpenGetLucky',\r\n            'prizeListByAward',\r\n            'candidateList',\r\n            'haveAwardCandidateSN',\r\n            'getLuckyWaitTimeArr',\r\n        ]),\r\n        needSetWebTitle() {\r\n            const that = this;\r\n            let needSetWebTitle = false;\r\n            if (!that.config.isTutorial && (!that.config.webTitle || ['Lucky Draw', 'LuckyDraw', 'luckydraw'].includes(that.config.webTitle))) {\r\n                needSetWebTitle = true;\r\n            }\r\n            return needSetWebTitle;\r\n        },\r\n    },\r\n    watch: {\r\n        triggerOpenGetLucky: {\r\n            immediate: true,\r\n            handler() {\r\n                const that = this;\r\n                if (that.triggerOpenGetLucky) {\r\n                    $(that.$refs.box).modal('show');\r\n                } else {\r\n                    $(that.$refs.box).modal('hide');\r\n                }\r\n            },\r\n        },\r\n    },\r\n    created() { },\r\n    mounted() {\r\n        const that = this;\r\n        $(that.$refs.box).bind('shown.bs.modal', () => {\r\n            that.award = '';\r\n            trackJS.mixpanel('GetLuckyOpen_click');\r\n            trackJS.gtag('event', 'GetLuckyOpen_click');\r\n        });\r\n        $(that.$refs.box).bind('hidden.bs.modal', () => {\r\n            trackJS.mixpanel('GetLuckyClose_click');\r\n            trackJS.gtag('event', 'GetLuckyClose_click');\r\n        });\r\n\r\n        if (that.triggerOpenGetLucky) {\r\n            $(that.$refs.box).modal('show');\r\n        } else {\r\n            $(that.$refs.box).modal('hide');\r\n        }\r\n    },\r\n    updated() { },\r\n    destroyed() { },\r\n    methods: {\r\n        ...mapMutations({\r\n            setFavicon: 'setFavicon',\r\n            setFocusCandidateSN: 'setFocusCandidateSN',\r\n            setFocusPrizeSN: 'setFocusPrizeSN',\r\n            triggerModal: 'triggerModal',\r\n        }),\r\n        gotoSetWebTitle() {\r\n            const that = this;\r\n            // that.triggerModal({ key: 'GetLucky', close: true });\r\n            // setTimeout(() => {\r\n            //     that.triggerModal({ key: 'Setting' });\r\n            // }, 100);\r\n\r\n            that.triggerModal({ key: 'GetLucky', close: true });\r\n            const config = {\r\n                offset: {\r\n                    top: 60,\r\n                    bottom: 60,\r\n                },\r\n                startCallback() {\r\n                    trackJS.mixpanel('TutorialStart_trigger', { type: 'WebsiteTitle' });\r\n                    trackJS.gtag('event', 'TutorialStart_trigger', { type: 'WebsiteTitle' });\r\n                },\r\n                closeCallback() {\r\n                    trackJS.mixpanel('TutorialEnd_trigger', { type: 'WebsiteTitle' });\r\n                    trackJS.gtag('event', 'TutorialEnd_trigger', { type: 'WebsiteTitle' });\r\n                },\r\n                step_callback(node, IntroInfo) {\r\n                    trackJS.mixpanel('TutorialStep_trigger', { type: 'WebsiteTitle', index: IntroInfo.index });\r\n                    trackJS.gtag('event', 'TutorialStep_trigger', { type: 'WebsiteTitle', index: IntroInfo.index });\r\n                },\r\n            };\r\n\r\n            const step = [\r\n                {\r\n                    target: '#SettingBox input[name=\"webTitle\"]',\r\n                    title: '獨特的抽獎',\r\n                    intro: '在抽獎前，設定一個屬於您的獨特抽獎活動名稱。',\r\n                    beforeAction(Element, TutorialNode, $next) {\r\n                        that.triggerModal({ key: 'Setting' });\r\n                        setTimeout(() => {\r\n                            $next();\r\n                        }, 500);\r\n                    },\r\n                },\r\n            ];\r\n            const tutorial1 = new Tutorial(step, config);\r\n            tutorial1.run();\r\n        },\r\n        editPrizeList() {\r\n            const that = this;\r\n            $(this.$refs.box).modal('hide');\r\n            that.triggerModal({ key: 'PrizeList' });\r\n        },\r\n        getLucky(prizeInfo) {\r\n            const that = this;\r\n            trackJS.mixpanel('GetLuckyChoosePrize_click', prizeInfo);\r\n            trackJS.gtag('event', 'GetLuckyChoosePrize_click', prizeInfo);\r\n\r\n            const drawCount = prizeInfo.drawCount || 1;\r\n            const remainingAmount = prizeInfo.amount - prizeInfo.count;\r\n\r\n            if (remainingAmount >= drawCount) {\r\n                const { haveAwardCandidateSN } = that;\r\n                let ValidateCandidateSN = []; // 所有合法候選人的 SN\r\n\r\n                that.candidateList.forEach((candidateInfo) => {\r\n                    if (candidateInfo.del === false && !haveAwardCandidateSN.includes(candidateInfo.sn)) {\r\n                        ValidateCandidateSN.push(candidateInfo.sn);\r\n                    }\r\n                });\r\n\r\n                if (ValidateCandidateSN.length >= drawCount) {\r\n\r\n                    // 隨機打亂候選人名單\r\n                    // 使用 Fisher-Yates (Knuth) shuffle 算法打亂陣列，確保隨機性\r\n                    for (let i = ValidateCandidateSN.length - 1; i > 0; i--) {\r\n                        const j = Math.floor(Math.random() * (i + 1));\r\n                        [ValidateCandidateSN[i], ValidateCandidateSN[j]] = [ValidateCandidateSN[j], ValidateCandidateSN[i]];\r\n                    }\r\n\r\n                    // 從打亂後的名單中取出 drawCount 數量的得獎者\r\n                    const winnersSN = ValidateCandidateSN.slice(0, drawCount);\r\n\r\n                    // 將抽出的多個得獎者 SN 存入 data 屬性\r\n                    that.winnerCandidateSNList = winnersSN;\r\n\r\n                    // 將所有合法的候選人（用於滾動視覺效果）存入\r\n                    that.ValidateCandidateSN = ValidateCandidateSN;\r\n                    that.ValidSNRandomRange = Math.pow(10, (`${that.ValidateCandidateSN.length}`).length);\r\n\r\n                    $(that.$refs.box).modal('hide');\r\n\r\n                    that.runTime = that.config.defaultRunTime;\r\n                    that.orgRunTime = that.config.defaultRunTime;\r\n                    trackJS.mixpanel('GetLuckyChoosePrizeRun_trigger', prizeInfo);\r\n                    trackJS.gtag('event', 'GetLuckyChoosePrizeRun_trigger', prizeInfo);\r\n\r\n                    // 在開始滾動前，先將 FocusCandidateSN 設為第一個抽中的人 (用於滾動結束後的第一個結果)\r\n                    that.setFocusCandidateSN(winnersSN[0]);\r\n                    that.setFocusPrizeSN(prizeInfo.prize_sn);\r\n\r\n                    // 開始滾動\r\n                    that.luckyAction();\r\n\r\n                } else {\r\n                    // ... (候選人不足的錯誤訊息保持不變)\r\n                    trackJS.mixpanel('GetLuckyChoosePrizeError_trigger', { error: 'not enough candidates' });\r\n                    trackJS.gtag('event', 'GetLuckyChoosePrizeError_trigger', { error: 'not enough candidates' });\r\n                    popup.warning({\r\n                        html: `候選人不足，此獎項需要 ${drawCount} 人，目前只有 ${ValidateCandidateSN.length} 人可抽`,\r\n                    });\r\n                }\r\n            } else {\r\n                // ... (剩餘數量不足的錯誤訊息保持不變)\r\n                trackJS.mixpanel('GetLuckyChoosePrizeError_trigger', { error: 'not enough' });\r\n                trackJS.gtag('event', 'GetLuckyChoosePrizeError_trigger', { error: 'not enough' });\r\n                popup.warning({\r\n                    html: `此獎項剩餘數量不足，需要 ${drawCount} 個名額，但只剩 ${remainingAmount} 個`,\r\n                });\r\n            }\r\n        },\r\n        luckyAction() {\r\n            const that = this;\r\n\r\n            // 滾動過程依然隨機選取一位候選人來做視覺展示\r\n            const sn_index = parseInt((Math.random() * 100000) % that.ValidateCandidateSN.length);\r\n            that.setFocusCandidateSN(that.ValidateCandidateSN[sn_index]); // 滾動過程中的隨機顯示\r\n\r\n            audio.ding.play();\r\n            that.setFavicon('run');\r\n            const { getLuckyWaitTimeArr } = that;\r\n\r\n            if (that.runTime > 0 && that.ValidateCandidateSN.length > 1) {\r\n                // ... (滾動計時邏輯保持不變)\r\n                let waitTime = 0;\r\n                if (that.orgRunTime < 10) {\r\n                    waitTime = 100;\r\n                } else {\r\n                    for (const index in getLuckyWaitTimeArr) {\r\n                        if (that.runTime >= getLuckyWaitTimeArr[index].limit) {\r\n                            waitTime = getLuckyWaitTimeArr[index].wait;\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n                console.log('waitTime', waitTime);\r\n                that.runTime -= 1;\r\n                clearTimeout(that.luckyActionTimer);\r\n                that.luckyActionTimer = setTimeout(() => {\r\n                    audio.ding.pause();\r\n                    audio.ding.currentTime = 0;\r\n                    that.luckyAction();\r\n                }, waitTime);\r\n            } else {\r\n                setTimeout(() => {\r\n                    trackJS.mixpanel('GetLuckyChoosePrizeStop_trigger');\r\n                    trackJS.gtag('event', 'GetLuckyChoosePrizeStop_trigger');\r\n\r\n                    // 停止滾動時，將 focus Candidate SN 設定為所有抽中的人\r\n                    that.setFocusCandidateSN(that.winnerCandidateSNList);\r\n\r\n                    that.triggerModal({ key: 'Lucky' });\r\n\r\n                    const index = parseInt((Math.random() * 10) % audio.winner.length);\r\n                    // audio.winner[index].play();\r\n                }, 600);\r\n            }\r\n        },\r\n    },\r\n};\r\n</script>\r\n<style lang=\"scss\" scoped></style>\r\n","import mod from \"-!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./main.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./main.vue?vue&type=script&lang=js\"","import { render, staticRenderFns } from \"./main.vue?vue&type=template&id=60bb32ab&scoped=true\"\nimport script from \"./main.vue?vue&type=script&lang=js\"\nexport * from \"./main.vue?vue&type=script&lang=js\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"60bb32ab\",\n  null\n  \n)\n\nexport default component.exports"],"names":["render","_vm","this","_c","_self","ref","staticClass","attrs","id","tabindex","role","_m","_v","needSetWebTitle","staticStyle","flex","on","click","gotoSetWebTitle","_e","class","disabled","prizeListByAward","length","_l","prizeInfo","key","prize_sn","type","amount","count","$event","getLucky","_s","title","drawCount","editPrizeList","_withStripped","audio","ding","Audio","winner","components","filters","props","data","ValidateCandidateSN","ValidSNRandomRange","defaultRunTime","runTime","orgRunTime","winnerCandidateSNList","computed","mapGetters","that","config","isTutorial","webTitle","includes","watch","triggerOpenGetLucky","immediate","handler","$","$refs","box","modal","created","mounted","bind","award","trackJS","mixpanel","gtag","updated","destroyed","methods","mapMutations","setFavicon","setFocusCandidateSN","setFocusPrizeSN","triggerModal","close","offset","top","bottom","startCallback","closeCallback","step_callback","node","IntroInfo","index","step","target","intro","beforeAction","Element","TutorialNode","$next","setTimeout","Tutorial","run","remainingAmount","haveAwardCandidateSN","candidateList","forEach","candidateInfo","del","sn","push","i","j","Math","floor","random","winnersSN","slice","pow","luckyAction","error","popup","warning","html","sn_index","parseInt","play","getLuckyWaitTimeArr","waitTime","limit","wait","console","log","clearTimeout","luckyActionTimer","pause","currentTime"],"sourceRoot":""}